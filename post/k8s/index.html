<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>K8s概念详解(一) - Betterfor - A dreamful developer</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="betterfor" /><meta name="description" content="从零开始学习k8s，超详细，超具体" />
<meta name="keywords" content="kubernetes, k8s基础概念" />







<meta name="generator" content="Hugo 0.56.0-DEV" />


<link rel="canonical" href="https://betterfor.github.io/post/k8s/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.19ae5a432863a072ec64433bb1020bd6d3401129f87d6f2ad5af3bcfd84168a1.css" integrity="sha256-Ga5aQyhjoHLsZEM7sQIL1tNAESn4fW8q1a87z9hBaKE=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="K8s概念详解(一)" />
<meta property="og:description" content="从零开始学习k8s，超详细，超具体" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://betterfor.github.io/post/k8s/" />
<meta property="article:published_time" content="2019-07-07T18:27:06+08:00" />
<meta property="article:modified_time" content="2019-07-07T21:27:06+08:00" />
<meta itemprop="name" content="K8s概念详解(一)">
<meta itemprop="description" content="从零开始学习k8s，超详细，超具体">


<meta itemprop="datePublished" content="2019-07-07T18:27:06&#43;08:00" />
<meta itemprop="dateModified" content="2019-07-07T21:27:06&#43;08:00" />
<meta itemprop="wordCount" content="7633">



<meta itemprop="keywords" content="k8s,helm," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="K8s概念详解(一)"/>
<meta name="twitter:description" content="从零开始学习k8s，超详细，超具体"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Betterfor</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/post/">全部文章</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/betterfor" rel="noopener" target="_blank">
              我的github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/about/">关于</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Betterfor
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/post/">全部文章</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/betterfor" rel="noopener" target="_blank">
              我的github
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://betterfor.github.io/about/">关于</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">K8s概念详解(一)</h1>
      
      <div class="post-meta">
        <time datetime="2019-07-07" class="post-time">
          2019-07-07 18:27:06
        </time>
        <div class="post-category">
            <a href="https://betterfor.github.io/categories/%E8%BF%90%E7%BB%B4/"> 运维 </a>
            
          </div>
        <span class="more-meta"> 约 7633 字 </span>
          <span class="more-meta"> 预计阅读 16 分钟 </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#一-基础概念">一、基础概念</a>
<ul>
<li>
<ul>
<li><a href="#1-cluster">1、Cluster</a></li>
<li><a href="#2-master">2、Master</a></li>
<li><a href="#3-node">3、Node</a></li>
<li><a href="#4-pod">4、Pod</a></li>
<li><a href="#5-controller">5、Controller</a></li>
<li><a href="#6-service">6、Service</a></li>
<li><a href="#7-namespace">7、Namespace</a></li>
</ul></li>
</ul></li>
<li><a href="#二-kubernetes架构">二、Kubernetes架构</a>
<ul>
<li>
<ul>
<li><a href="#1-master节点">1、master节点</a></li>
<li><a href="#2-node节点">2、Node节点</a></li>
<li><a href="#3-部署过程">3、部署过程</a></li>
</ul></li>
</ul></li>
<li><a href="#三-运行应用">三、运行应用</a>
<ul>
<li>
<ul>
<li><a href="#3-1-deployment">3.1、Deployment</a>
<ul>
<li><a href="#3-1-1-配置文件简介">3.1.1 配置文件简介</a></li>
<li><a href="#3-1-2-伸缩">3.1.2 伸缩</a></li>
<li><a href="#3-1-3-failover">3.1.3 Failover</a></li>
<li><a href="#3-1-4-用label控制pod的位置">3.1.4 用label控制pod的位置</a></li>
</ul></li>
<li><a href="#3-2-daemonset">3.2、DaemonSet</a>
<ul>
<li><a href="#3-2-1-kube-flannel-ds">3.2.1 kube-flannel-ds</a></li>
<li><a href="#3-2-2-kube-proxy">3.2.2 kube-proxy</a></li>
</ul></li>
<li><a href="#3-3-job">3.3、job</a></li>
<li><a href="#3-4-定时job">3.4、定时Job</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<p>​   &#8195;<a href="https://kubernetes.io/"><strong>Kubernetes</strong></a>是一个开源的，用于管理云平台中多个主机上的容器化的应用，Kubernetes的目标是让部署容器化的应用简单并且高效，<strong>Kubernetes</strong>提供了应用部署，规划，更新，维护的一种机制。</p>

<h3 id="一-基础概念">一、基础概念</h3>

<h5 id="1-cluster">1、Cluster</h5>

<p>&#8195;Cluster是计算、存储和网络资源的集合，kubernetes利用这些资源运行各种基于容器的应用。</p>

<h5 id="2-master">2、Master</h5>

<p>&#8195;Master是Cluster的大脑，它的主要职责是调度，即决定将应用放在哪里运行。Master运行linux操作系统，可以是物理机或虚拟机。为了实现高可用，可以运行多个Master。</p>

<h5 id="3-node">3、Node</h5>

<p>&#8195;Node的职责试运行容器应用。Node由Master管理，Node负责监控并汇报容器的状态，同时根据Master的要求管理容器的生命周期。Node运行再Linux操作系统上，可以是物理机或虚拟机。</p>

<h5 id="4-pod">4、Pod</h5>

<p>&#8195;Pod是kubernetes的最小工作单元。每个Pod包含一个或多个容器。Pod中的容器会作为一个整体被Master调度到一个Node上运行。Kubernetes引入Pod主要基于下面两个目的：</p>

<ul>
<li><p>可管理性有些容器天生就是需要紧密联系，一起工作。POd提供了比容器更高层次的抽象，将他们封装到一个部署单元中。kubernetes以pod为最小单位进行调度、扩展、共享资源、管理生命周期。</p></li>

<li><p>通信和资源共享Pod中所有容器使用同一个网络namespace，及相同的IP地址和Port空间。它们可以直接用localhost通信。同样的，这些容器可以共享存储，当kubernetes挂在volume到pod，本质上是将volume挂在到pod中的每一个容器。</p></li>
</ul>

<p>pods有两种使用方式：</p>

<ul>
<li><p>运行单一容器one-container-per-Pod是kubernetes最常见的模型，这种情况下，只是将单个容器简单封装成pod。即使是只有一个容器，kubernetes管理的也是pod而不是直接管理容器。</p></li>

<li><p>运行多个容器问题在于：哪些容器应该放到一个pod中？答案是：这些容器联系必须非常紧密，而且需要直接共享资源。举个例子。pod包含两个容器：一个File Puller，一个Web Server。File Puller会定期从外部的Content Manager中拉去最新的文件，将其存放再共享的volume中，Web Server从volume读取文件，响应Consumer的请求。这两个是紧密协作的，它们一起为Consumer提供最新的数据；同时它们也通过volume共享数据，所以放到一个pod是合适的。再看一个反例：是否需要将tomcat和mysql放到一个pod中？Tomcat从Mysql读取数据，它们之间需要协作，但还不至于放到一个pod中一起部署、一起启动、一起停止。同时它们之间是通过JDBC交换数据，并不是直接共享存储，座椅放到各自的pod中更为合适。</p></li>
</ul>

<h5 id="5-controller">5、Controller</h5>

<p>&#8195;kubernetes通常不会直接创建pod，而是通过Controller来管理pod。Controller中定义了pod的部署特性，比如有几个副本、再什么样的Node上运行等。为了满足不同的业务场景，kubernetes提供了多种Controller，包括Deployment、ReplicaSet、DaemonSet、StatefulSet、Job等，我们逐一讨论。</p>

<p>（1）Deployment是最常用的Controller。可以管理pod的多个副本，并确保pod按照期望的转台运行。</p>

<p>（2）ReplicaSet实现Pod的多副本管理。使用Department时会自动创建ReplicaSet，也就是说Department是通过ReplicaSet来管理Pod的多个副本，我们通常不需要直接使用ReplicaSet。（3）DaemonSet用于每个Node最多只运行一个pod副本的场景。正式其名所示，daemonSet通常用于daemon。</p>

<p>（4）StatefulSet能够保证pod的每个副本再整个生命周期中名称是不变的，而其他Controller不提供这个功能。当某个Pod发生故障需要删除并重新启动时，Pod的名称会发生变化，同时StatefulSet会保证副本按照固定的顺序启动、更新或删除。</p>

<p>（5）Job用于运行结束就删除的应用，而其他Controller中的Pod通常是长期持续运行。</p>

<h5 id="6-service">6、Service</h5>

<p>&#8195;Deployment可以部署多个副本，每个Pod都有自己的IP，外界如何访问这些副本呢？Kubernetes Service定义了外界访问一组特定的Pod的方式。Service有自己的IP和端口，Service为Pod提供负载均衡。Kubernetes运行容器（Pod）与访问容器这两项任务分别由Controller和Service执行。</p>

<h5 id="7-namespace">7、Namespace</h5>

<p>&#8195;如果有多个用户或项目组使用同一个Kubernetes Cluster，如何将他们创建的Controller、Pod等资源分开呢？Namespace可以将一个物理的Cluster逻辑上划分成多个虚拟Cluster，每个Cluster就是一个Namespace。不同Namespace里的资源是完全隔离的。kubernetes默认创建两个Namespace。</p>

<ul>
<li><p>default：创建资源时如果不指定，都将被放到这个Namespace中。</p></li>

<li><p>kube-system：kubernetes自己创建的系统资源将放到这个Namespace中。</p></li>
</ul>

<h3 id="二-kubernetes架构">二、Kubernetes架构</h3>

<h5 id="1-master节点">1、master节点</h5>

<p>master是kubernetes Cluster的大脑，运行着的Daemon服务包括kube-apiserver、kube-scheduler、kube-controller-manager、ectd和pod网络（例如flannel）。</p>

<p>（1）API Server（kube-apiserver）API Server提供HTTP/HTTPS Restful API，即kubernetes APi。API Server是kubernetes Cluster的前端接口，各种客户端工具（CLI或UI）以及kubernetes其他组件可以通过它管理Cluster的各种资源。</p>

<p>（2）Scheduler（kube-scheduler）Scheduler负责决定将Pod放在哪个Node上运行。Scheduler在调度时会充分考虑Cluster的拓扑结构，当前各个节点的负载，以及应对高可用、性能、数据亲和性的需求。</p>

<p>（3）Controller Manager（kube-controller-manager）Controller Manager负责管理Cluster各种资源，保证资源处于预期的状态。Controller Manager由多种Controller组成，包括replication controller、endpoints controller、namespace controller、serviceaccounts controller等。不同的controller管理不同的资源。例如，replication controller管理Deployment、StatefulSet、DaemonSet的生命周期，namespace controller管理Namespace资源。</p>

<p>（4）ectdectd负责保存kubernetes Cluster的配置信息和各种资源的状态信息。当数据发生变化时，ectd会快速地通知kubernetes相关组件。</p>

<p>（5）Pod网络Pod要能够相互通信，kubernetes Cluster必须部署Pod网络，flannel是其中一个可选方案。</p>

<h5 id="2-node节点">2、Node节点</h5>

<p>Node是Pod运行的地方，kubernetes支持docker、rkt等容器Runtime。Node上运行的kubernetes组件有kubelet、kube-proxy和Pod网络。</p>

<p>（1）kubeletkubelet是Node的agent，当Scheduler确定在某个Node上运行Pod后，会将Pod的具体配置信息（image、volume等）发送给该节点的kubelet，kubelet会根据这些信息创建和运行容器，并向Master报告运行状态。</p>

<p>（2）kube-proxyservice在逻辑上代表了后端的多个Pod，外界通过service访问Pod。service接收到的请求是如何转发到Pod的呢？这就是kube-proxy要完成的工作。每个Node都会运行kube-proxy服务，它负责将访问service的TCP/UDP数据流转发到后端容器。如果有多个副本，kube-proxy会实现负载均衡。</p>

<p>（3）Pod网络Pod要能够相互通信，kubernetes Cluster必须部署Pod网络，flannel是其中一个可选方案。</p>

<h5 id="3-部署过程">3、部署过程</h5>

<ul>
<li>kuberctl发送部署请求到API Server</li>
<li>API Server通知Controller Manager创建一个deployment资源</li>
<li>Scheduler执行调度任务，将两个副本Pod分发到k8s-node1 和k8s-node2</li>
<li>k8s-node1和k8s-node2上的kubectl在各自的节点创建并运行Pod</li>
</ul>

<p>补充两点：</p>

<p>（1）应用的配置和当前状态信息保存在ectd中，执行kubectl get pod时API Server会从ectd中读取这些数据</p>

<p>（2）flannel会为每个Pod都分配IP。因为没有创建service，所以目前kube-proxy还没参与进来。</p>

<h3 id="三-运行应用">三、运行应用</h3>

<h5 id="3-1-deployment">3.1、Deployment</h5>

<pre><code class="language-cmd">kubectl run nginx-deployment --image=nginx:1.7.9 --replicas=2
</code></pre>

<p>上面的命令将部署包含2个副本的Deployment nginx-deployment，容器的image为nginx：1.7.9</p>


<link rel="stylesheet" href="/css/hugo-easy-gallery.css" />
<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/deploy_run.png" />
    </div>
    <a href="/content/post/k8s/deploy_run.png" itemprop="contentUrl"></a>
  </figure>
</div>




<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/deploy_describe.png" />
    </div>
    <a href="/content/post/k8s/deploy_describe.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>主要看Events，这里告诉我们创建了一个ReplicaSet  nginx-deployment-7c7d6486fc，Events是Deployment的日志，记录了ReplicaSet的启动过程。通过上面的分析，也验证了Deployment通过ReplicaSet来管理pod的事实。</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/rs.png" />
    </div>
    <a href="/content/post/k8s/rs.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>Controlled By指明此ReplicaSet是由Deployment nginx-deployment创建的。Events是两个副本Pod创建的日志。</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/pods.png" />
    </div>
    <a href="/content/post/k8s/pods.png" itemprop="contentUrl"></a>
  </figure>
</div>




<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/decribe_pod.png" />
    </div>
    <a href="/content/post/k8s/decribe_pod.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>Controlled By指明此pod是由ReplicaSet nginx-deployment-7c7d6486fc-bl8x4创建的。Events记录了Pod的启动过程。如果操作失败（比如image不存在），也能在这里找到原因。</p>

<p>总结过程 ：</p>

<ul>
<li><p>用户通过kubectl创建Deployment</p></li>

<li><p>Deployment创建ReplicaSet</p></li>

<li><p>ReplicaSet创建pod</p></li>
</ul>

<div class="shortcode-notice note">
  <div class="shortcode-notice-title note">
    
      笔记
    
  </div>
  

<p><strong>命令 VS 配置文件</strong></p>

<p>k8s通过两种创建资源方式：</p>

<ul>
<li><p>用kubectl命令创建，比如“kubectl run nginx-deployment &ndash;image=nginx:1.7.9 &ndash;replicas=2”，在命令行中通过参数指定资源的属性</p></li>

<li><p>通过配置文件和kubectl apply创建。要完成同样的工作，可执行命令“kubectl apply -f nginx.yaml”</p>

<pre><code>apiVersion: extensions/v1beta1
kind: Deployment
metadata:
name: nginx-deployment
spec:
replicas: 2
template:
  metadata:
    labels:
      app: web_server
  spec:
    containers:
    - image: nginx:1.7.9
      name: nginx
</code></pre></li>
</ul>

<p><em>资源的属性写在配置文件中，格式为yaml</em></p>

<ul>
<li><p>基于命令的方式：简单、直观、快捷、上手快；适合临时测试或实验</p></li>

<li><p>基于配置文件的方式：配置文件描述了What，即应用最终要达到的状态；配置文件提供了创建资源的模板，能够重复部署；可以像管理代码一样管理部署；适合正式的、跨环境的、规模化部署；要求熟悉配置文件语法，有一定难度</p></li>
</ul>

<p></div></p>

<h6 id="3-1-1-配置文件简介">3.1.1 配置文件简介</h6>

<ul>
<li><p>apiVersion 是当前配置格式的版本</p></li>

<li><p>kind 是要创建的资源类型</p></li>

<li><p>matadata 是该资源的元数据，name是必须的元数据项</p></li>

<li><p>spec 部分是该Deployment的规格说明</p></li>

<li><p>replicas 指明副本数量，默认为1</p></li>

<li><p>template 定义pod的模板，这里是配置文件的重要部分</p></li>

<li><p>metadata 定义pod的元数据，至少要定义一个label。label的key和value可以任意指定</p></li>

<li><p>spec 描述pod的规格，此部分定义pod中每一个容器的属性，name和image是必须的</p></li>
</ul>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/nginx_yaml.png" />
    </div>
    <a href="/content/post/k8s/nginx_yaml.png" itemprop="contentUrl"></a>
  </figure>
</div>


<h6 id="3-1-2-伸缩">3.1.2 伸缩</h6>

<p>新创建的副本会调度到k8s-node1和k8s-node2上。处于安全考虑，默认配置下kubernetes不会讲pod调度到Master节点上，如果希望master当做node使用</p>

<pre><code class="language-cmd">kubectl taint node master node-role.kubernetes.io/master-
</code></pre>

<p>如果恢复master only状态</p>

<pre><code class="language-cmd">kubectl taint node master node-role.kubernetes.io/master=&quot;&quot;:NoSchedule
</code></pre>

<h6 id="3-1-3-failover">3.1.3 Failover</h6>

<p>如果节点故障，k8s会检查到节点不可用，将pod标记为Unknown，并在其他节点新建pod，维持总副本数。当节点恢复后，Unknown节点会被删除，不过已运行的pod不会重新调度回去。</p>

<h6 id="3-1-4-用label控制pod的位置">3.1.4 用label控制pod的位置</h6>

<p>默认配置下，Scheduler会将pod调度到所有可用的node。不过有些情况我们希望将pod部署到指定的node，比如有大量磁盘I/O的pod部署到ssd的node或gpu的node</p>

<p>k8s通过label来实现这个功能。label是key-value对，各种资源都可以设置label，灵活添加各种自定义属性。比如执行如下命令标注node1是配置ssd的节点</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/label.png" />
    </div>
    <a href="/content/post/k8s/label.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>disktype=ssd已经成功添加到node1，除了disktype，node还有k8s自己维护的label，有了自定义label，接下来可以指定pod部署到node1 。</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/nginx-deploy_yaml.png" />
    </div>
    <a href="/content/post/k8s/nginx-deploy_yaml.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>在pod模板的spec里通过nodeSelector指定此pod部署到具有label disktype=ssd的node上。要删除label disktype，执行</p>

<pre><code class="language-cmd">kubectl label node node1 disktype-
</code></pre>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/label_node.png" />
    </div>
    <a href="/content/post/k8s/label_node.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>不过此时pod并不会重新部署，除非在nginx.yml中删除nodeSelector设置，然后通过kubectl apply重新部署，k8s会删除之前的pod并调度和运行新的pod。</p>

<h5 id="3-2-daemonset">3.2、DaemonSet</h5>

<p>Deployment部署的副本Pod会分布在各个Node上，每个Node都可能运行好几个副本。</p>

<p>DaemonSet的不同之处在于：每个Node上只能运行一个副本。</p>

<p>DaemonSet的典型应用场景：</p>

<ul>
<li><p>在集群的每个节点上运行存储Daemon，比如glusterd或ceph</p></li>

<li><p>在每个节点上运行日志搜集Daemon，比如flunentd或logstash</p></li>

<li><p>在每个节点上运行监控Daemon，比如Prometheus Node Exporter或collectd</p></li>
</ul>

<p>其实kubernetes自己就在用DaemonSet运行系统组件。</p>

<pre><code class="language-cmd">kubectl get daemonset --namespace=kube-system
</code></pre>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/daemonset.png" />
    </div>
    <a href="/content/post/k8s/daemonset.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>Daemo kube-flannel-ds和kube-proxy分别负责在每个节点上运行flannel和kube-proxy组件</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/daemon_pod.png" />
    </div>
    <a href="/content/post/k8s/daemon_pod.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>因为flannel和kube-proxy属于系统组件，需要在明航通过&ndash;namespace=kube-system指定namespace kube-system。若不指定，返回默认的default资源。</p>

<h6 id="3-2-1-kube-flannel-ds">3.2.1 kube-flannel-ds</h6>

<p>flannel的DaemonSet定义在kube-flannel.yml中。</p>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  name: kube-flannel-ds-amd64
  namespace: kube-system
  labels:
    tier: node
    app: flannel
spec:
  template:
    metadata:
      labels:
        tier: node
        app: flannel
    spec:
      hostNetwork: true
      nodeSelector:
        beta.kubernetes.io/arch: amd64
      containers:
      - name: kube-flannel
        image: quay.io/coreos/flannel:v0.11.0-amd64
        command:
        - /opt/bin/flanneld
        args:
        - --ip-masq
        - --kube-subnet-mgr
</code></pre>

<ul>
<li>DaemonSet配置文件的语法和结构与Deployment几乎完全一样，只是将kind设为DaemonSet。</li>
<li>hostName指定pod直接使用node网络，相当于docker run &ndash;network=host。考虑到flannel需要为集群提供网络连接，这个要求合理。</li>
<li>containers定义了运行flannel服务的容器</li>
</ul>

<h6 id="3-2-2-kube-proxy">3.2.2 kube-proxy</h6>

<p>由于无法拿到kube-proxy的yaml文件，只能运行如下命令查看配置：</p>

<pre><code class="language-cmd">kubectl edit daemonset kube-proxy --namespace=kube-system
</code></pre>

<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  labels:
    k8s-app: kube-proxy
  name: kube-proxy
  namespace: kube-system
spec:
  selector:
    matchLabels:
      k8s-app: kube-proxy
  template:
    metadata:
      creationTimestamp: null
      labels:
        k8s-app: kube-proxy
    spec:
      containers:
      - command:
        - /usr/local/bin/kube-proxy
        - --config=/var/lib/kube-proxy/config.conf
        - --hostname-override=$(NODE_NAME)
        env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        image: k8s.gcr.io/kube-proxy:v1.14.0
        imagePullPolicy: IfNotPresent
        name: kube-proxy
        resources: {}
status:
  currentNumberScheduled: 2
  desiredNumberScheduled: 2
  numberAvailable: 2
  numberMisscheduled: 0
  numberReady: 2
  observedGeneration: 1
  updatedNumberScheduled: 2
</code></pre>

<ul>
<li>kind：daemonSet指定这是一个DaemonSet类型的资源。</li>
<li>containers定义了kube-proxy容器</li>
<li>status是当前DaemonSet的运行时状态，这个部分是kubectl edit特有的。其实kubernetes集群中每个当前运行的资源都可以通过kubectl edit查看配置和运行状态。</li>
</ul>

<h5 id="3-3-job">3.3、job</h5>

<p>容器按照持续运行时间可分为两类：服务类容器和工作类容器。</p>

<p>服务类容器通常持续提供服务，需要一直运行，比如HTTP Server、Daemon 等。</p>

<p>工作类容器则是一次性任务，比如批处理程序，完成后容器就退出。kubernetes的Deployment、ReplicaSet和DaemonSet都用于管理服务类容器；对于工作类容器使用Job。</p>

<p>先看一个简单的Job配置</p>

<pre><code class="language-yaml">apiVersion: batch/v1
kind: Job
metadata:
  name: myjob
spec:
  template:
    metadata:
      name: myjob
    spec:
      containers:
      - name: hello
        image: busybox
        command: [&quot;echo&quot;,&quot;hello k8s job&quot;]
      restartPolicy: Never
</code></pre>

<ul>
<li><p>batch/v1是当前Job的APIVersion</p></li>

<li><p>指明当前资源的类型为Job</p></li>

<li><p>restartPolicy指定在什么情况下需要重启容器。对于Job，只能设置为Never或者OnFailure。对于其他controller（比如Deployment）,可以设置为Always。</p></li>
</ul>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/job.png" />
    </div>
    <a href="/content/post/k8s/job.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>当启动容器失败时，根据restartPolicy：Never，此失败容器不会重启，但completions为0，所以job controller会启动新的Pod。为了终止这个行为，可以删除job。如果restartPolicy设置为OnFailure，容器失败后会自动重启。</p>

<pre><code class="language-yaml">apiVersion: batch/v1
kind: Job
metadata:
  name: myjob
spec:
  parallelism: 2 # 并行数量
  completions: 6 # 完成数量
  template:
    metadata:
      name: myjob
    spec:
      containers:
      - name: hello
        image: busybox
        command: [&quot;echo&quot;,&quot;hello k8s job&quot;]
      restartPolicy: Never
</code></pre>

<p>每次运行2个Pod，知道共6个Pod成功完成。现实中存在需要并行处理的场景。比如批处理，每个副本（pod）都会从任务池中读取任务并执行，副本越多，执行时间越短，效率越高。</p>

<h5 id="3-4-定时job">3.4、定时Job</h5>

<p>linux有crom程序定时执行任务，kubernetes的CronJob提供了类似的功能，可以定时执行Job。</p>

<pre><code class="language-yaml">apiVersion: batch/v2alpha1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: &quot;*/1 * * * *&quot;
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            command: [&quot;echo&quot;,&quot;hello k8s job!&quot;]
          restartPolicy: OnFailure
</code></pre>

<ul>
<li>batch/v2alpha1是当前CronJob的APIVersion</li>
<li>指明当前资源的类型为CronJob</li>
<li>schedule指定什么时候运行Job，其格式与Linux cron一致。这里 */1 * * * * 的含义是每一分钟启动一次</li>
<li>jobTemplate定义Job模板，格式与前面的job一致</li>
</ul>

<p>刚启动时会失败，因为kubernetes默认没有enable CronJob功能，需要在kube-apiserver中加入这个功能。修改kube-apiserver的配置文件 /etc/kubernetes/manifests/kube-apiserver.yaml</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/kube-apiserver_yaml.png" />
    </div>
    <a href="/content/post/k8s/kube-apiserver_yaml.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p>kube-apiserver本身也是一个pod，在启动参数加上 &ndash;runtime-config=batch/v2alpha1=true即可，然后重启kubelet服务</p>

<pre><code class="language-yaml">systemctl restart kubelet.service
</code></pre>

<p>kubectl 会重启kube-apiserver Pod。通过kubectl api-versions会确认kube-apiserver现在已经支持batch/v2alpha1</p>



<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/batch_v2alpha1.png" />
    </div>
    <a href="/content/post/k8s/batch_v2alpha1.png" itemprop="contentUrl"></a>
  </figure>
</div>




<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" >
    <div class="img">
      <img itemprop="thumbnail" src="/content/post/k8s/hello_job.png" />
    </div>
    <a href="/content/post/k8s/hello_job.png" itemprop="contentUrl"></a>
  </figure>
</div>


<p> </p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">betterfor</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2019-07-07 21:27:06</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">原创文章，如需转载请注明文章作者和出处。谢谢！</span>
  </p>
</div>


    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/path/to/your/wechat-qr-code.png">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/path/to/your/alipay-qr-code.png">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://betterfor.github.io/tags/k8s/">k8s</a>
          <a href="https://betterfor.github.io/tags/helm/">helm</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/k8s2/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">K8s概念详解(二)</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "betterfor/commons-for-blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:1697606384@qq.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="http://github.com/betterfor" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://betterfor.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        betterfor
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>










</body>
</html>
